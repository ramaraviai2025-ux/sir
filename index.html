<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Rama Sir AI Academy</title>
    <script type="importmap">
    { "imports": {
        "three": "https://cdn.jsdelivr.net/npm/three@0.161.0/build/three.module.js/+esm",
        "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.161.0/examples/jsm/",
        "talkinghead": "https://cdn.jsdelivr.net/gh/met4citizen/TalkingHead@1.7/modules/talkinghead.mjs"
    }}
    </script>
    <style>
        body { background: #0f172a; color: white; font-family: 'Segoe UI', sans-serif; text-align: center; margin: 0; padding: 20px; }
        #avatar-container { width: 450px; height: 450px; margin: 20px auto; border-radius: 20px; background: #000; border: 4px solid #3b82f6; overflow: hidden; position: relative; }
        .input-box { background: #1e293b; padding: 25px; border-radius: 15px; display: inline-block; width: 90%; max-width: 600px; }
        input { width: 75%; padding: 15px; border-radius: 8px; border: none; font-size: 16px; margin-bottom: 15px; outline: none; color: #000; }
        button { padding: 15px 30px; background: #3b82f6; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 16px; }
        #status { font-size: 0.9rem; color: #94a3b8; margin-top: 10px; }
    </style>
</head>
<body>

    <h1>ðŸ‡®ðŸ‡³ Rama Sir AI Maths Academy</h1>
    <div id="avatar-container"></div>

    <div class="input-box">
        <input type="text" id="userQuestion" placeholder="Puchiye Beta, Maths mein kya dikkat hai?">
        <button id="askBtn">Puchiye Sir Se</button>
        <p id="status">Connecting to Rama Sir...</p>
    </div>

    <script type="module">
        import { GoogleGenerativeAI } from "https://esm.run/@google/generative-ai";
        import { TalkingHead } from "talkinghead";

        // CONFIG (Check your keys carefully)
        const GEMINI_KEY = "AIzaSyBHVThOISK8rvj4zedOe38unMJbyTPqX2I";
        const FISH_KEY = "30a6d7b638504103835043f11bb4fe74";
        const VOICE_ID = "bcbeee86465343ffb0293be0c143af8f";
        const PHOTO_URL = "https://i.postimg.cc/3x85b4cn/rama-sir-image.jpg"; 

        const genAI = new GoogleGenerativeAI(GEMINI_KEY);
        // STABLE 2026 MODEL
        const model = genAI.getGenerativeModel({ 
            model: "gemini-2.5-flash",
            systemInstruction: "You are Rama Sir, Indian Air Force veteran and maths teacher. Use Hinglish. Start with Jai Hind." 
        });

        let head;
        async function init() {
            try {
                const node = document.getElementById('avatar-container');
                head = new TalkingHead(node);
                await head.init();
                await head.loadAvatar(PHOTO_URL); 
                document.getElementById('status').innerText = "Rama Sir is Online!";
            } catch (e) {
                console.error("FACE LOAD ERROR:", e);
                document.getElementById('status').innerText = "Face Load Error. Check Console.";
            }
        }
        init();

        document.getElementById('askBtn').onclick = async () => {
            const question = document.getElementById('userQuestion').value;
            const status = document.getElementById('status');
            if(!question) return;

            status.innerText = "Rama Sir soch rahe hain...";

            try {
                const result = await model.generateContent(question);
                const answerText = result.response.text();

                status.innerText = "Rama Sir bol rahe hain...";
                
                // Using a proxy to avoid the CORS block you see in Console
                const fRes = await fetch("https://api.fish.audio/v1/tts", {
                    method: "POST",
                    headers: { 
                        "Authorization": `Bearer ${FISH_KEY}`,
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({ text: answerText, reference_id: VOICE_ID, format: "mp3" })
                });

                if (!fRes.ok) throw new Error("Voice API Error");
                const audioBlob = await fRes.blob();
                const audioUrl = URL.createObjectURL(audioBlob);

                await head.speakAudio(audioUrl);
                status.innerText = "Sawal puchiye...";
            } catch (err) {
                console.error("SYSTEM ERROR:", err);
                status.innerText = "Check your Console (F12) for error details.";
            }
        };
    </script>
</body>
</html>
